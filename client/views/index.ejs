<%- include('partials/header') %>
<a-scene physics='driver: ammo; debug: true;' background="color: #FAFAFA">
    <!-- CAMERA, CONTROLLERS AND ENVIRONMENT SETTINGS -->
    <%- include('partials/basic_settings') %>

    <!-- BASE PLATE FOR CLOSER UI DESIGN -->
    <%- include('partials/base_plate') %>

    <!-- current node view -->
    <a-sphere ammo-body="type: dynamic" ammo-shape="type: box" grabbable id= "current_node" visible= "false" color="yellow" radius="0.2" position="0 1 -1.5" shadow 
    onmousedown="this.setAttribute('wireframe', true)"
    onclick="this.setAttribute('wireframe', false)">
        <a-text
            id ="current_node_label"
            position="0 0.3 0"
            width="1"
            color="white"
            value="NO NODE SELECTED"
        ></a-text>
    </a-sphere>
    
    <a-toast autoshow= 'false' message="" position="0 2 1" action="OK"></a-toast>
    <!--<a-cylinder color="gray" height="0.05" radius="0.5" position="0 0.75 1.5" shadow></a-cylinder>-->

    <!-- node search view -->

    <a-keyboard position="-1.1 1 -1.4" rotation="-35 0 0" scale="1.5 1.5 1.5" visible='true'></a-keyboard>
    <a-input id='input-1' position="-0.5 1.7 -1.5" placeholder="Search for node" color="black" width="0.6" visible="true"
    onclick="this.focus()">
        <a-button id="go-button" position="0.6 0 0" value="go" width='0.3' scale="0.5 0.5 0.5"></a-button>
    </a-input>
    

    <a-cylinder id="center_booth" color="gray" height="0.05" radius="0.5" position="0 0.95 -1.5" shadow></a-cylinder>

    <!-- NODE INFO VIEW -->
    <a-rounded color="#cccccc" opacity='0.9' position="-0.75 1 2" width="1" height="1" radius="0.05" rotation="0 110 0"></a-rounded>
    <a-rounded color="#cccccc" opacity='0.9' position="0.75 1 2" width="1" height="1" radius="0.05" rotation="0 45 0"></a-rounded>
    <a-rounded color="#cccccc" opacity='0.9' position="-0.5 1 2" width="1" height="1" radius="0.05" rotation="0 0 0"></a-rounded>

</a-scene>
<script type="text/javascript">

    window.onload = function(event) {
        var input1= document.querySelector('#input-1');
        var button = document.querySelector('#go-button');
        var str="";
        var keyboard = document.querySelector("a-keyboard");
        var toast = document.querySelector('a-toast');

        toast.addEventListener('actionclick', ()=>{
            toast.hide();

        });

        keyboard.addEventListener('input', (e)=>{
            str += e.detail;
            input1.setAttribute('value', str);
        });

        keyboard.addEventListener('backspace', (e)=>{
            str = str.slice(0, -1);
            input1.setAttribute('value', str);
        });

        button.addEventListener('click', ()=> {
            fetch('/node_search', {
                    method: 'POST',
                    headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({input: input1.value})
                })
                .then(res=>res.json())
                .then(res =>{
                    //console.log(res.data[0]);
                    document.querySelector('#current_node').setAttribute('visible', res.data[0] ? "true":"false");
                    document.querySelector('#current_node_label').setAttribute('value', res.data[0] ? `${res.data[0].name}`:"NO NODE FOUND");
                    document.querySelector('#current_node_label').setAttribute('visible', res.data[0] ? "true":"false");
                    document.querySelector('#center_booth').setAttribute('position', res.data[0] ? "0 0.75 -1.5":"0 0.95 -1.5");
                    keyboard.setAttribute('visible',res.data[0] ? "false":"true" );
                    input1.setAttribute('visible',res.data[0] ? "false":"true" );
                    toast.setAttribute('message',res.data[0] ? "Node found!": "Please try another query");
                    toast.show();
                });
        });
    };
    



</script>

<%- include('partials/footer') %>